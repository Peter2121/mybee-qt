# Режим работы N1: локальный, CBSD интерпретатор

Данный режим позволяет запускать виртуальные машины локально на тех платформах, на которых работает пакет `cbsd`. В данный момент это платформы на базе Linux и FreeBSD OS.
Наиболее близкий аналог работы данного режима - Oracle VirtualBox.

Если Ваша рабочая система - мобильное устройство, MacOS или Windows, вам подойдут два других способа ( [Режим работы N2: через протокол SSH, CBSD интерпретатор/MyBee](myb-qt-cbsd-ssh.md) или [Режим работы N3: через RestAPI/MyBee](myb-qt-api.md) ).

Ввиду особенности в виде взаимодействия с интерпретатором /usr/local/bin/cbsd при работе в этом режиме, вам потребуется выполнить некоторую предварительную настройку вашего окружения, касающиеся прав доступа, а именно:

1) в вашей системе должен быть установлен пакет `cbsd` ( Linux, FreeBSD );
2) ваш пользователь, от которого вы запускаете приложение, должен входить в группу 'cbsd'.

Для Linux:
```
usermod -a -G cbsd xuser
```

Для FreeBSD:
```
pw usermod xuser -G cbsd

```

, где `xuser` - login вашего пользователя.

Перезайдите в систему, чтобы применить изменение

3) У вашего пользователя должны быть полномочия на запуск интерпретатора /usr/local/bin/cbsd от пользователя 'root' через конфигурацию sudo.

Для этого, создайте файл */etc/sudoers.d/20_cbsd* (для Linux) или */usr/local/etc/sudoers.d/20_cbsd* (для FreeBSD) с содержимым:
```
Defaults     env_keep += "workdir DIALOG NOCOLOR CBSD_RNODE"
Cmnd_Alias   MYB_CBSD_CMD = /usr/local/bin/cbsd
xuser        ALL=(ALL) NOPASSWD:SETENV: MYB_CBSD_CMD
```

установите корректные права доступа на файл:

```
(Linux):  % chmod 0400 /etc/sudoers.d/20_cbsd
(FreeBSD):% chmod 0400 /usr/local/etc/sudoers.d/20_cbsd
```

и убедитесь, что интерпретатор /usr/local/bin/cbsd доступен для вашего пользователя как без sudo, так и через `sudo` без ввода пароля:
```
cbsd version
sudo cbsd version
```

Если все в порядке, приложение готово к использованию.

# Создание первой виртуальной машины

### выбор бакенда

Если все настройки системы соблюдены, при запуске `mybee-qt`, в качестве одного из методов взаимодействия (Setup Server connection) будет 'File', где в качестве Path должен быть указан путь до интерпретатора CBSD: /usr/local/bin/cbsd.

Кроме этого, вам необходимо выбрать и подтвердить используемый SSH ключ, по-умолчанию, приложение будет использовать системный локальный ключ CBSD ( /usr/jails/.ssh/id_rsa ).

![cbsd_local1.png](/images/cbsd_local1.png)

Подтвердите ключ кликнув на эту строчку и переходите к выбору профиля гостевой ОС.

### выбор профиля гостевой ОС

На следующем шаге, выберете тип гостевой ОС (группированный список из основных деривативов/семейств (Linux, BSD, Windows, Other)) и непосредственно желаемый дистрибутив.
Список профилей обновляется как при обновлении версии приложения, так и отдельной директивой. Кроме этого, вы можете создавать свои собственные профили и даже gold-образы на базе уже существующих - об этом, читайте в [соответствующей главе](profiles.md)

![cbsd_local2.png](/images/cbsd_local2.png)

### ресурсы ВМ: vCPU, RAM, storage

Последний шаг перед созданием - выбор конфигурации гостевой машины в виде характеристик ядер виртуального процессора, объем оперативной памяти и дисковое пространство системного диска.
По-умолчанию, вам предлагаются минимально возможные для того или иного профиля характеристики, которые гарантируют нормльный запуск ОС, однако в зависимости от того, как вы будете эксплуатировать ВМ,
вам могут потребоваться дополнительные ресурсы. После создания, вы всегда можете реконфигурировать эти параметры без пересоздания ВМ.

![cbsd_local3.png](/images/cbsd_local3.png)

### Процесс создания ВМ

В дальнейшем процессе польователь уже не принимает участие  - если образ не был ранее прогрет (используете выбранный профиль первый раз), приложение просканирует доступные зеркала для выбранного образа для получения максимально быстрого для
вас ресурса и начнет скачивать образ. Скорость работы данного этапа зависит, в основном, от скорости вашего интернета - просто ожидайте, когда процесс получения образа завершниться.

![cbsd_local4.png](/images/cbsd_local4.png)

Образ, на основе которого будет создана ваша ВМ будет сохранена и закеширована, поэтому повтороное использование данного профиля приведет к более быстрому созданию ВМ, поскольку скачивать образ уже не потребуется.
По окончанию процесса создании ВМ, диалог возвращает вас в привычный основной экран приложения.

![cbsd_local5.png](/images/cbsd_local5.png)


Чтобы начать работу в ВМ, можете перейти к главе [Работа с ВМ][myb-qt-vm.md), либо прочесть о двух других методах работы с гипервизорами, если у вас есть в наличии выделенные сервера на базе [FreeBSD OS](https://www.freebsd.org/)/[Linux](https://kernel.org/) или используете дистрибутив [MyBee](https://myb.convectix.com).


---

Дальше: [Режим работы N2: через протокол SSH, CBSD интерпретатор/MyBee](myb-qt-cbsd-ssh.md)
